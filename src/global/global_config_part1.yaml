defaults:
  headless: false
  timeout: 30
  render_retry: 15

metadata_by_url:
  "https://console.opsnow.com/home":                          { service: "Console",        menu: "Dashboard",             site: "Global", company: "옵스나우 주식회사" }
  "https://asset.opsnow.com/#/dashboard":                     { service: "Asset",          menu: "Summary",               site: "Global", company: "옵스나우 주식회사" }
  "https://asset.opsnow.com/asset/usage":                     { service: "Asset",          menu: "Usage",                 site: "Global", company: "옵스나우 주식회사" }
  "https://asset.opsnow.com/asset/scheduler":                 { service: "Asset",          menu: "Resource Scheduler",    site: "Global", company: "옵스나우 주식회사" }
  "https://cloudopti.opsnow.com/dashboard":                   { service: "Cost",           menu: "Summary",               site: "Global", company: "옵스나우 주식회사" }
  "https://metering.opsnow.com/cost/cost-analytics":          { service: "Cost",           menu: "Cost Analytics",        site: "Global", company: "옵스나우 주식회사" }
  "https://cloudopti.opsnow.com/finopskpi/savings":           { service: "Cost",           menu: "Optimization Results",  site: "Global", company: "옵스나우 주식회사" }
  "https://governance.opsnow.com/dashboard":                  { service: "Governance",     menu: "Summary",               site: "Global", company: "옵스나우 주식회사" }
  "https://governance.opsnow.com/finopskpi/kpi":              { service: "Governance",     menu: "Cloud Efficient Index", site: "Global", company: "옵스나우 주식회사" }
  "https://service.opsnow.com/cms/enterprise/management":     { service: "KubeExplorer",   menu: "Summary",               site: "Global", company: "옵스나우 주식회사" }
  "https://service.opsnow.com/saas/datadog/summary":          { service: "Datadog",        menu: "Summary",               site: "Global", company: "옵스나우 주식회사" }
  "https://service.opsnow.com/console":                       { service: "Configuration",  menu: "Console Brokerage",     site: "Global", company: "옵스나우 주식회사" }
  "https://service.opsnow.com/organization/":                 { service: "Configuration",  menu: "Organization Tree",     site: "Global", company: "옵스나우 주식회사" }

checks:
  - name: "Server Count"
    url: "https://console.opsnow.com/home"
    type: value_required
    locators:
      - { kind: xpath, value: "//p[contains(.,'Server')]/following::em[contains(@class,'-number-l')][1]" }

  - name: "Month to Date Cost"
    url: "https://console.opsnow.com/home"
    type: mtd_cost
    locators:
      - { kind: xpath, value: "//p[contains(.,'Month to Date Cost')]/following-sibling::p" }

  - name: "Total Server Count"
    url: "https://asset.opsnow.com/#/dashboard"
    type: value_required
    locators:
      - { kind: xpath, value: "//p[normalize-space()='Total Server']/following::em[contains(@class,'value')][1]" }
      - { kind: xpath, value: "//p[contains(.,'Total Server')]/following::em[contains(@class,'value')][1]" }
      - { kind: xpath, value: "//*[contains(@class,'count') and .//p[contains(.,'Total Server')]]//*[self::em or self::span][contains(@class,'value')][1]" }
    js_fallback:
      strategy: scan_labels
      label_keys: ["total server","total servers","server","servers","서버","총 서버"]

  - name: "Usage (Current) - AWS EC2 item visible"
    url: "https://asset.opsnow.com/asset/usage"
    type: element_exists
    locators:
      - { kind: xpath, value: "//span[normalize-space(.)='EC2']" }
      - { kind: xpath, value: "//*[self::h2 or self::h3 or self::div][contains(normalize-space(.),'AWS EC2')]" }
      - { kind: xpath, value: "//*[contains(@class,'aws')][.//text()[contains(.,'EC2')]]" }
    js_fallback: { strategy: ec2_near_aws }

  - name: "Resource Scheduler - Create Schedule button exists"
    url: "https://asset.opsnow.com/asset/scheduler"
    type: element_exists
    locators:
      - { kind: xpath, value: "//button[contains(@class,'btn-primary')][contains(normalize-space(.),'Create Schedule')]" }
      - { kind: xpath, value: "//button[contains(normalize-space(.),'Create Schedule')]" }
      - { kind: xpath, value: "//*[self::button or self::a][contains(normalize-space(.),'Create Schedule')]" }
